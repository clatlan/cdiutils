# GitLab CI for CDIutils using ESRF pyci templates

include:
  - project: dau/ci/pyci
    file: .gitlab-ci-template.yml

variables:
  # disable coverage for faster testing (re-enable with PYTEST_COV: "--cov=./src")
  PYTEST_COV: ""
  # run pytest on tests/ directory (default is ".")
  PYTEST_DIR: "tests"
  # additional pytest options
  PYTEST_OPTIONS: "-v -ra --tb=short"

# lint job (ruff formatting and linting)
lint:
  stage: style
  extends: .style
  script:
    - pip install ruff
    - ruff check src/cdiutils tests
    - ruff format --check --line-length 79 src/cdiutils tests

# test on Python 3.10
test-3.10:
  extends: .test-3.10

# test on Python 3.11
test-3.11:
  extends: .test-3.11

# test on Python 3.12
test-3.12:
  extends: .test-3.12

# build source distribution
build_sdist:
  extends: .build_sdist

# test the sdist on Python 3.10
test_sdist-3.10:
  extends: .test_sdist-3.10

# test the sdist on Python 3.11
test_sdist-3.11:
  extends: .test_sdist-3.11

# test the sdist on Python 3.12
test_sdist-3.12:
  extends: .test_sdist-3.12

# build documentation (if you have docs in docs/ with sphinx)
build_doc:
  extends: .build_doc

# deploy documentation to GitLab Pages (main branch only)
pages:
  extends: .pages

# create assets for releases
assets:
  extends: .assets

# deploy to PyPI (manual, protected tags only)
# pypi:
#   extends: .pypi

# deploy to Test PyPI (manual)
# testpypi:
#   extends: .testpypi
